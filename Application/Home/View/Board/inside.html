
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>
	<title>用户个人收集</title>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/draw/css/style1.css">
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/draw/css/inside.css">
		<link rel="stylesheet" href="__PUBLIC__/Home/css/reset.css" />
		<link rel="stylesheet" href="__PUBLIC__/Home/css/waterfall_index.css" />
		<script type="text/javascript" src="__PUBLIC__/jquery-1.8.2.min.js"></script>
		<style type="text/css">
			.save{width: 54px;height: 32px;background: #79B6C8;float: right;margin-right: 23px;border-radius: 5px;line-height: 32px;text-align: center;color: #fff;font-size: 12px;}
		</style>
	</head>
<body style="background: #efefec; position: relative;" >
<include file="Common/alert_view_style" />	
<include file="Common/header" />
<div class="w1">        
<div class="w touxiangkuai_mt" style="margin-top: 60px;">
	<div class="uph clearfloat">
			<div class="yuanjiaohezi fl"><!--圆角盒子开始-->
		    	<div class="renwukuai">
		        	<div>
		        		<img src="{$data['member']['headimg']}" >
		            </div>
		        </div>
	        </div><!--圆角盒子结束-->
	        <div class="uph_right fr clearfix"><!--右侧文字及设置按钮开始-->
	        	<div class="uph_right_left fl">{$data['member']['member_name']}</div>
	            <div class="uph_right_right fr">
	            	<a href="#" class="anniu" style="background: #fff;border: 0px;">
	                </a>
	            </div>
	        </div><!--右侧文字及设置按钮结束-->
        <div class="uph_dibu"><!--头像块底部开始-->
	        	<ul>
	            	<li><a href="{:U('index',array('member_id'=>$_SESSION['member_id']))}" class="uph_dibu_gongneng wenzi_juzhong">{$data['member']['board_num']}板块</a></li>
	                <li><a href="#" class="uph_dibu_gongneng wenzi_juzhong02">{$data['member']['board_list_num']}收集</a></li>
	            </ul>
            <div class="zhong fr">
					<input type="text" name="" class="serach01" value="" placeholder="搜索你喜欢的"/>
					<a href="#" class="icon02"></a>
			</div>
        </div><!--头像块底部结束-->
    </div>
</div>
</div>
<!--版纳条部分   结束-->
<!--弹框-->
		<div class="tk">
			<div class="tk_top">
				<span class="fl">转采</span>
				<a href="javascript:;" class="tk_close fr">
					<img src="__PUBLIC__/Home/img/waterfall/tk_close.png">
				</a>
			</div>
			<form class="tk_cnt clearfix" id="collect">
				<div class="tk_cnt_left">
					<img src="">
					<div class="tk_cnt_left_bj"></div>
				</div>
				<div class="tk_cnt_right">
					<div class="tk_cnt_right_one">
						<select>
							<option></option>
						</select>
					</div>
					<div class="tk_cnt_right_two">
						<textarea name="title" ></textarea>
					</div>
				</div>
			</form>
			<div class="tk_bot">
				<a href="javascript:;" class="tk_bot_add">添加画板</a>
				<a href="javascript:;" class="tk_bot_down">采下来</a>
			</div>
		</div>
		<!--添加画板-->
		<div class="tk_add">
			<div class="tk_top">
				<span class="fl">添加画板</span>
				<a href="javascript:;" class="tk_close1 fr">
					<img src="__PUBLIC__/Home/img/waterfall/tk_close.png">
				</a>
			</div>
			<div class="tk_input">
				<span>名称：</span><input type="text" name="board_name" placeholder="请输入画板名称" />
			</div>
			<div class="tk_bot">
				<a href="#" class="tk_bot_down">添加画板</a>
			</div>
		</div>
<div id="main">
	<foreach name="data['picture']" item='v' key='k'>
				<div class="pin">

						<div class="single_hide clearfix">
							<if condition="$_SESSION['member_id']">
								<div class="hide_left">
									<a href="javascript:;" p_id="{$v['box']['p_id']}">GET</a>
								</div>
							<else />
								<div class="hide_left">
									<a href="javascript:;" >GET</a>
								</div>
							</if>
							<!--<if condition="!$_SESSION['member_id']">
								<div class="hide_right">
									<a href="javascript:;" class="zan_no click"></a>
								</div>
							<else />
								<in name="v['box']['p_id']" value="$data['member']['picture_click']">
									<div class="hide_right">
										<a href="javascript:;" tida="{$v['box']['p_id']}" class="zan_yes click"></a>
									</div>
								<else />
									<div class="hide_right">
										<a href="javascript:;" tida="{$v['box']['p_id']}" class="zan_no click"></a>
									</div>
								</in>
							</if>-->
							<if condition="$_SESSION['member_id']">
								<a href="{:U('board/edit',array('board_list_id'=>$v['box']['board_list_id']))}" class="save">编辑</a>
							</if>
						</div>

					<div class="box">
						<a href="{:U('waterfall/qing',array('p_id'=>$v['box']['p_id']))}">
							<foreach name="v['box']['thumb']" item='value' key='key'>
								<img src="__UPLOAD__{$value}">
							</foreach>
						</a>
						<div style="padding: 10px;">
							<foreach name="v['box']['keyword']" item='vv' key='kk'>
								<if condition="$kk eq 0">
									<span>{$vv}</span>
								<else />
									<span>#{$vv}</span>
								</if>
							</foreach>
							<ul class="zf_zan clearfix">
								<li class="zf"><span>{$v['box']['click_num']}</span></li>
								<li class="zan"><span>{$v['box']['collect_num']}</span></li>
							</ul>
						</div>
						<div class="user clearfix">
							<a class="tx"></a>
							<div class="user_name">
								<span><a href="{:U('board/single',array('merchant_merchant_id'=>$v['box']['merchant_merchant_id']))}">{$v['box']['merchant_name']}</a>公司</span><br />
								<span><a href="#">{$v['box']['title']}</a></span>
							</div>
						</div>
					</div>
				</div>
			</foreach>
		</div>	
		<img src="__PUBLIC__/Home/img/waterfall/gif.gif" id="loading" style="position:absolute;bottom:0;left:50%;display: none;">
		<img src="__PUBLIC__/Home/img/waterfall/loading_end.png" id="ending" style="position:absolute;bottom:0px;left:43%;display: none;">
	<script type="text/javascript" src='__PUBLIC__/Home/js/waterfall.js' defer="defer"></script>
			<script type="text/javascript" src="__PUBLIC__/Home/js/masonry.js" defer="defer"></script>
			<script type="text/javascript" defer="defer">
				window.onload = function() {

					waterfall('main', 'pin');
					var ajaxState = true;
					//定义全局变量控制,获取当前显示页数
				}
				var page_num = 2;
				/**
				 * 创建分屏加载
				 */
				$(window).scroll(function() {
					var page_height = $(document).height(); //是获取整个页面的高度
					var wind_height = $(window).height(); //是获取当前也就是浏览器所能看到的页面的那部分的高度
					var bottom_height = $(document).height() - $(window).height();
					var now_height = $(document).scrollTop();
					if(now_height >= bottom_height) {
						step_page();
					}

				});

				/**
				 * 创建异步加载分页方法
				 */
				function step_page() {
					if("{$_GET['merchant_merchant_id']}"){
						var merchant_merchant_id = "{$_GET['merchant_merchant_id']}";
					}else{
						var member_id = "{$_GET['member_id']}";
					}
					$.ajax({
						type: "post",
						url: "{:U('home/waterfall/loading')}",
						data: {page_num: page_num,merchant_merchant_id:merchant_merchant_id,member_id:member_id},
						dataType: 'json',
						beforeSend: function() {
							$("#loading").css('display', 'block');
						},
						success: function(phpdata) {
							if(phpdata){
								$("#main").append(phpdata);
								waterfall('main', 'pin');
							}else{
								$("#ending").css('display', 'block');
							}
							var num = $("#main .pin").length - 1;
							var pos_h = parseInt($("#main .pin").eq(num).css('top')) + parseInt($("#main .pin").eq(num).height() + 120) + 'px';
							$("#main").css('height',pos_h);
						},
						complete: function() {
							$("#loading").css('display', 'none');
							ajaxState = true;
							page_num++;
						}
					});
				};

				/**
				 * 城市互联异步
				 */
				/*$(".area_omit").change(function() {
					var area_id = $("select.area_omit").val();
					$.ajax({
						type: "post",
						url: "{:U('waterfall/index')}",
						data: {
							area_id: area_id
						},
						dataType: 'json',
						success: function(phpdata) {
							if(phpdata) {
								var str = '<select style="margin-left: 8px;" class="area_city" name="area_id[]"><option>市/地区</option>';
								$.each(phpdata, function(k, v) {
									str += '<option value="' + v.area_id + '">' + v.aname + '</option>';
								});
								str += '</select>';
								$('.area_city').html(str);
							}
						}
					});
				})*/

				//点赞的ajax
//				$('.click').on('click', function() {
//					var board_list_id = $(this).attr('tids');
//					var P_id = $(this).attr('tida');
//					var This = $(this);
//					$.ajax({
//						type: "post",
//						url: "{:U('Help/help')}",
//						data: {
//							board_list_id: board_list_id,
//							P_id: P_id
//						},
//						dataType: 'json',
//						success: function(phpdata) {
//							if(!phpdata) {
//								window.wxc.xcConfirm('您还未登录，请登录后再点赞！', window.wxc.xcConfirm.typeEnum.confirm);
//							} else {
//								if(phpdata.type) {
//									window.wxc.xcConfirm('点赞成功', window.wxc.xcConfirm.typeEnum.success);
//									This.removeClass('zan_no').addClass('zan_yes');
//								} else {
//									window.wxc.xcConfirm('取消点赞', window.wxc.xcConfirm.typeEnum.success);
//									This.removeClass('zan_yes').addClass('zan_no');
//								}
//								This.parents('.pin').find('.zf_zan .zan').html(phpdata.num);
//							}
//
//						}
//					});
//				})

				/**
				 * 创建转载ajax
				 */
				$('.hide_left a').on('click', function() {
					var p_id = $(this).attr('p_id');
					var board_list_id = $(this).attr('board_list_id');
					var This;
					$.ajax({
						type: "post",
						url: "{:U('waterfall/perfect')}",
						data: {
							p_id: p_id,
							board_list_id: board_list_id
						},
						dataType: 'json',
						success: function(phpdata) {
							if(!phpdata.p_id) {
								window.wxc.xcConfirm(phpdata.content, window.wxc.xcConfirm.typeEnum.confirm);
							}else{
								var str = '<div class="tk_top"><span class="fl">转采</span><a href="javascropt:;"  class="tk_close fr"><img src="__PUBLIC__/Home/img/waterfall/tk_close.png"></a></div><form class="tk_cnt clearfix" id="collect"><div class="tk_cnt_left">';
								str += '<img src="__UPLOAD__' + phpdata.img_url[0] + '">';
								str += '<input type="hidden" name="p_id" id="p_id" value="'+phpdata.p_id+'" />';
								str += '<div class="tk_cnt_left_bj"></div></div><div class="tk_cnt_right"><div class="tk_cnt_right_one"><select name="board_id">';
								if(phpdata.board) {
									$.each(phpdata.board, function(k,v) {
										str += '<option value="'+v.board_id+'">' + v.board_name + '</option>';
									});
								} else {
									str += '<option>您还没有画板</option>';
								}
								str += '</select></div><div class="tk_cnt_right_two">';
								str += '<textarea name="title" >' + phpdata.title + '</textarea>';
								str += '</div></div></form><div class="tk_bot"><a href="#" class="tk_bot_add">添加画板</a><a href="#" class="tk_bot_down">采下来</a></div>';
								$('.tk').html(str);
								$('.tk').show();
							}
						}
					});
				});

				//采集图片的ajax
			$('.tk').on('click','.tk_bot_down',function() {
					var title = $('textarea[name=title]').val();
					var picture_p_id = $('input[name=p_id]').val();
					var board_id = $('select[name=board_id]').val();
					$.ajax({
						type: "post",
						url: "{:U('waterfall/collect')}",
						data: {title:title,picture_p_id:picture_p_id,board_id:board_id},
						dataType: 'json',
						success: function(phpdata) {
							if(phpdata.type == 1) {
								$('.tk').hide();
									window.wxc.xcConfirm('采集完成', window.wxc.xcConfirm.typeEnum.success);
							} else {
									window.wxc.xcConfirm('采集失败', window.wxc.xcConfirm.typeEnum.error);
							}
						}
					});
				})
				$(".tk").on('click','.tk_close',function() {
					$(".tk").hide();
				})
				$(".tk").on('click','.tk_bot_add',function() {
					$(".tk_add").show();
				})
				
	//添加画板的ajax
			$('.tk_close1').click(function(){
				$('.tk_add').hide();
			})
			$(".tk_bot_down").click(function(){
				var board_name = $('input[name=board_name]').val();
				$.ajax({
					type:"post",
					url:"{:U('waterfall/addboard')}",
					data:{board_name:board_name},
					dataType: 'json',
					success: function(phpdata) {
						if(phpdata){
							var str = '<option value="'+phpdata.board_id+'" >' + phpdata.board_name + '</option>';
//								var str = '<div class="tk_cnt_right_one"><select name="board_id">';
//								$.each(phpdata, function(k,v) {
//									str += '<option value="'+v.board_id+'">' + v.board_name + '</option>';
//								});
//									str += '</select></div>';
							$('select[name=board_id]').append(str);
							$('.tk_cnt_right_one select').val(phpdata.board_id);
							$('.tk_add').hide();
						}
					}
				});
			})
</script>
	</body>
</html>
