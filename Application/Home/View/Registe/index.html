<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>注册新用户</title>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/Registe/css/zhuce_style.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/Registe/css/reset.css">
<script type="text/javascript" src="__PUBLIC__/Home/Registe/js/jquery.js"></script>
</head>
<body>
	<include file="Common/header"/>
	<div class="content">
		<div class="zhuce">
	    	<div id="tab">
	        	<ul class="clearfix ul1">
	            	<li class="on"><a href="javascript:;" class="a_name">个人用户</a></li>
	                <li><a href="javascript:;" class="a_name">企业用户</a></li>
	                <li><a href="javascript:;" class="a_name">婚礼人</a></li>
	            </ul>
	            <form action="member" method="post" class="on qiye_form clearfix zhuce" table="user">
	            	<ul>
	                	<li style="margin:0;">
	                    	<label>用户名</label>
	                        <input type="text" placeholder="" class="input1" name="member_name" />
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>密码</label>
	                        <input type="password" placeholder="" class="input1" name="password" />
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>确认密码</label>
	                        <input type="password" placeholder="" class="input1 not"/>
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>手机号码</label>
	                        <input type="text" placeholder="" class="input1" name="phone" />
	                        <span class="span1"></span>
	                    </li>
	                    <!-- <li>
	                    	<label>手机验证码</label>
	                        <input type="text" placeholder="" class="input2"/>
	                        <a href="#" class="a_yanzheng">60s后再次获取验证码</a>
	                        <span class="span1">验证码不正确</span>
	                    </li> -->
	                    <li>
	                    	<label>验证码</label>
	                        <input type="text" placeholder="" class="input2" name="code" />
	                        <img src="{:U('Common/code')}">
	                        <a href="javascript:;" class="a1 cut">换一张</a>
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label></label>
	                        <input type="checkbox" style="vertical-align:middle;" checked="checked"/>
	                        <span class="span2">我已阅读并接受<a href="#" class="a2">《嘉仕澜德婚礼服务协议》</a></span>
	                    </li>
	                    <li>
	                    	<label></label>
	                        <button type="button" class="tijiao">立即注册</button>
	                        <span class="span2">已有嘉仕澜德账号？<a href="#" class="a3">登陆</a></span>
	                    </li>
	                </ul>
	            </form>
	            <form action="merchant" method="post" class="qiye_form clearfix zhuce" table="business">
	            	<ul>
	            		<li style="margin:0;">
	                    	<label>身份</label>
	                        <select name="identity" id="" class="input1" style="width:295px;">
	                        	<option value="">-请选择-</option>
	                        	<option value="wedding">婚庆</option>
	                        	<option value="studio">影楼</option>
	                        	<option value="hotel">酒店</option>
	                        </select>
	                        <span class="span1"></span>
	                    </li>
	                	<li>
	                    	<label>公司名称</label>
	                        <input type="text" placeholder="" class="input1" name="m_name" />
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>联系人</label>
	                        <input type="text" placeholder="" class="input1" name="leagal_person" />
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>联系人电话</label>
	                        <input type="text" placeholder="" class="input1" name="mobile_phone" />
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>公司座机</label>
	                        <input type="text" placeholder="" class="input1" name="phone" />
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>邮箱</label>
	                        <input type="text" placeholder="" class="input1" name="email" />
	                        <span class="span1"></span>
	                    </li>
	                    <!-- <li>
	                    	<label>手机验证码</label>
	                        <input type="text" placeholder="" class="input2"/>
	                        <a href="#" class="a_yanzheng">60s后再次获取验证码</a>
	                        <span class="span1">验证码不正确</span>
	                    </li> -->
	                    <li>
	                    	<label>验证码</label>
	                        <input type="text" placeholder="" class="input2" name="code" />
	                        <img src="{:U('Common/code')}">
	                        <a href="javascript:;" class="a1 cut">换一张</a>
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label></label>
	                        <input type="checkbox" style="vertical-align:middle;" checked="checked"/>
	                        <span class="span2">我已阅读并接受<a href="#" class="a2">《嘉仕澜德婚礼服务协议》</a></span>
	                    </li>
	                    <li>
	                    	<label></label>
	                        <button type="button" class="tijiao">立即注册</button>
	                        <span class="span2">已有嘉仕澜德账号？<a href="#" class="a3">登陆</a></span>
	                    </li>
	                </ul>
	            </form>
	            <form action="diy" method="post" class="qiye_form clearfix zhuce" table="diy">
	            	<ul>
	                	<li style="margin:0;">
	                    	<label>用户名</label>
	                        <input type="text" placeholder="" class="input1" name = 'name'/>
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>密码</label>
	                        <input type="password" placeholder="" class="input1" name='password'/>
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>确认密码</label>
	                        <input type="password" placeholder="" class="input1 not"/>
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label>手机号码</label>
	                        <input type="text" placeholder="" class="input1" name="phone" />
	                        <span class="span1"></span>
	                    </li>
	                    <!-- <li>
	                    	<label>手机验证码</label>
	                        <input type="text" placeholder="" class="input2"/>
	                        <a href="#" class="a_yanzheng">60s后再次获取验证码</a>
	                        <span class="span1">验证码不正确</span>
	                    </li> -->
	                    <li>
	                    	<label>验证码</label>
	                        <input type="text" placeholder="" class="input2" name="code" />
	                        <img src="{:U('Common/code')}">
	                        <a href="javascript:;" class="a1 cut">换一张</a>
	                        <span class="span1"></span>
	                    </li>
	                    <li>
	                    	<label></label>
	                        <input type="checkbox" style="vertical-align:middle;" checked="checked"/>
	                        <span class="span2">我已阅读并接受<a href="#" class="a2">《嘉仕澜德婚礼服务协议》</a></span>
	                    </li>
	                    <li>
	                    	<label></label>
	                        <button class="tijiao" type="button">立即注册</button>
	                        <span class="span2">已有嘉仕澜德账号？<a href="#" class="a3">登陆</a></span>
	                    </li>
	                </ul>
	            </form>
	        </div>
	    </div>
	</div>
	<include file="Common/footer"/>
</body>

	<script>
		$(function(){
			//$("#news .newsTabs li").mouseenter(function(){
			$(".ul1 li").click(function(){
				var num=$(this).index();
				//标题
				$(".ul1 li").removeClass("on");
				$(".ul1 li").eq(num).addClass("on");
				//内容
				$("#tab form").removeClass("on");
				$("#tab form").eq(num).addClass("on");
			});

			//切换验证码
			$('.cut').click(function(){
				$(this).siblings('img').attr('src',"{:U('Common/code',array('id' => 2))}");
			});


			//input失去焦点
			$(".zhuce input").blur(function() {
				if($(this).parents('form').attr('action') == 'merchant'){
					if(!$("select[name='identity']").val()){
						return false;
					}else{
						var identity = $("select[name='identity']").val();
					};
				}else{
					var identity = null;
				};
				if($(this).attr('type') == 'checkbox'){
					return false;
				};
				if($(this).hasClass('not')){
					var num = $(this).parent().index();
					var pwd = $(this).parents('ul').find('li').eq(num-1).find('input').val();
					var newPwd = $(this).val();
					if(newPwd == ''){
						$(this).siblings('span').html('请输入密码').css('color','red');
						return false;
					}else if(newPwd != pwd){
						$(this).siblings('span').html('两次密码不一致').css('color','red');
						return false;
					}else{
						$(this).siblings('span').html('输入正确').css('color','green');
						return false;
					};
					
				};
				var name = $(this).attr('name');
				switch(name){
					case 'name':
					var title = '用户名';
					break;
					case 'password':
					var title = '密码';
					break;
					case 'phone':
					var title = '手机号';
					break;
					case 'code':
					var title = '验证码';
					break;
					case 'member_name':
					var title = '用户名';
					break;
					case 'm_name':
					var title = '公司名称';
					break;
					case 'leagal_person':
					var title = '联系人';
					break;
					case 'mobile_phone':
					var title = '联系人电话';
					break;
					case 'email':
					var title = '邮箱';
					break;
				};
				//公司座机号和其他注册的手机号冲突，进行判断
				var table = $(this).parents().parent('form').attr('table');
				if(table == 'business' && name == 'phone'){
					var title = '公司座机号';
				};
				var val = $(this).val();
				//未输入值
				if(!val){
					$(this).siblings('span').html('请输入'+title).css('color','red');
					return false;
				}else if(name == 'password'){
					$(this).siblings('span').html('输入正确').css('color','green');			
				};
				//判断用户名
				if(name == 'name' || name == 'member_name'){
					var reg = /[\D\s]/;
					if(!reg.test(val)){
						$(this).siblings('span').html('不能使用纯数字').css('color','red');
						return false;
					};
				};
				//正则验证手机和座机
				if(name == 'phone'){
					if(table != 'business'){
						var myreg = /^(0|86|17951)?(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
						if(!myreg.test(val)){
							$(this).siblings('span').html('请输入有效的手机号码').css('color','red');
							return false;
						};
					}else{
						var myreg = /^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/;
						if(!myreg.test(val)){
							$(this).siblings('span').html('请输入有效的座机号码').css('color','red');
							return false;
						};
					};
				};
				//正则验证座机
				if(table == 'business' && name == 'mobile_phone'){
					var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
					if(!myreg.test(val)){
						$(this).siblings('span').html('请输入有效的手机号码').css('color','red');
						return false;
					};
				};
				//验证邮箱
				if(table == 'business' && name == 'email'){
					var myreg = /^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$/;
					if(!myreg.test(val)){
						$(this).siblings('span').html('请输入有效的邮箱地址').css('color','red');
						return false;
					};
				};
				//密码不查询
				if(name == 'password'){
					return false;
				};
				var This = $(this);
				if(name != 'code' && val){
					$.ajax({
						url:"{:U('deal')}",
						type:'post',
						data:{table:table,name:name,value:val,identity:identity},
						dataType:'text',
						success:function(phpData){
							if(phpData == ''){
								This.siblings('span').html(title+'可以使用').css('color','green');
							}else{
								This.siblings('span').html(phpData).css('color','red');
							};	
						}
					});
				}else if(name == 'code' && val){
					This.siblings('span').html('');
				}
			});

			//表单提交
			$('.zhuce button').click(function() {
				var check = $(this).parents('ul').find('input[type="checkbox"]').is(':checked');
				if(!check){
					alert('请仔细阅读嘉仕澜德婚礼服务协议');
					return false;
				};
				if($(this).parents('form').attr('action') == 'merchant'){
					if(!$("select[name='identity']").val()){
						alert('请选择身份');
						return false;
					}else{
						var identity = $("select[name='identity']").val();
					};
				}else{
					var identity = null;
				}
				//验证表单数据
				var data = $(this).parents('form').serializeArray();
				This = $(this);
				msg = "";
				var table = This.parents().parent('form').attr('table');
				$.each(data, function(k, v) {
					if(v.value == ''){
						switch(v.name){
							case 'name':
							msg = '请填写用户名';
							break;
							case 'password':
							msg = '请填写密码';
							break;
							case 'phone':
							msg = '请填写手机号';
							break;
							case 'code':
							msg = '请填写验证码';
							break;
							case 'member_name':
							msg = '请填写用户名';
							break;
							case 'm_name':
							msg = '请填写公司名称';
							break;
							case 'leagal_person':
							msg = '请填写联系人';
							break;
							case 'mobile_phone':
							msg = '请填写联系人电话';
							break;
							case 'email':
							msg = '请填写邮箱';
							break;
						};
						//公司座机号和其他注册的手机号冲突，进行判断
						if(table == 'business' && v.name == 'phone'){
							msg = '请输入公司座机号';
						};
					};
					//判断用户名
					if(v.name == 'name' || v.name == 'member_name'){
						var reg = /[\D\s]/;
						if(!reg.test(v.value)){
							msg = '用户名不能使用纯数字';
						};
					};
					//验证两次密码
					if(v.name == 'password' && v.value != ''){
						var newPwd = This.parents('ul').find('.not').val();
						if(v.value != newPwd){
							msg = '两次密码不一致';
						};
					};
					//验证手机和座机
					if(v.name == 'phone' && v.value != ''){
						if(table == 'business'){
							var myreg = /^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/;
							if(!myreg.test(v.value)){
								msg = '座机号码格式不正确'
							};
						}else{
							var myreg = /^(0|86|17951)?(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
							if(!myreg.test(v.value)){
								msg = '手机格式不正确';
							};
						};
					};
					if(v.name == 'mobile_phone' && v.value != '' && table == 'business'){
						var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
						if(!myreg.test(v.value)){
							msg = '联系人手机格式不正确';
						};
					};
					//验证邮箱
					if(table == 'business' && v.name == 'email'){
						var myreg = /^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$/;
						if(!myreg.test(v.value)){
							msg = '邮箱格式错误';
						};
					};
				});
				//查询
				$.ajax({
					cache: false,
					async: false,
					url:"{:U('post_deal')}",
					type:'post',
					data:{table:table,data:data},
					dataType:'text',
					success:function(phpData){
						if(phpData != ''){
							msg = phpData;
						}
					}
				});
				//没有错误信息执行提交
				if(msg){
					alert(msg);
				}else{
					This.parents('form').submit();
				};
			});
		});
	</script>
	
</html>
